(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[793],{95730:function(e,t,a){Promise.resolve().then(a.bind(a,2014))},2014:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return page}});var r=a(57437),n=a(90500),i=a(2265),l=a(88938),s=a(49050),o=a(20879),d=a(96507),c=a(73701),u=a(39279),h=a(30666),g=a(15795),p=a(19464),m=a(98489),x=a(66988),f=a(95781),j=a(92226),clientes_enhancedTableHead=e=>{let{order:t,orderBy:a,onRequestSort:n}=e,createSortHandler=e=>t=>{n(t,e)};return(0,r.jsx)(x.Z,{children:(0,r.jsx)(m.Z,{children:[{id:"name",numeric:!1,disablePadding:!0,label:"Nombre"},{id:"email",numeric:!1,disablePadding:!1,label:"E-mail"},{id:"phone",numeric:!1,disablePadding:!1,label:"Celular"},{id:"numBuys",numeric:!0,disablePadding:!1,label:"Cant. Compras"},{id:"numProducts",numeric:!0,disablePadding:!1,label:"# Productos"},{id:"total",numeric:!0,disablePadding:!1,label:"Total"},{id:"category",numeric:!1,disablePadding:!1,label:"Categoria"}].map(e=>(0,r.jsx)(h.Z,{align:e.numeric?"right":"left",padding:"normal",sortDirection:a===e.id&&t,children:(0,r.jsxs)(f.Z,{active:a===e.id,direction:a===e.id?t:"asc",onClick:createSortHandler(e.id),children:[e.label,a===e.id?(0,r.jsx)(d.Z,{component:"span",sx:j.Z,children:"desc"===t?"sorted descending":"sorted ascending"}):null]})},e.id))})})},Z=a(34989),b=a(43226),P=a(29872),C=a(40182),D=a(14647),v=a(92750),Y=a(74124),S=a(76722),y=a(74548),w=a.n(y),M=a(28874),R=a(50898),F=a(31601),page=()=>{let[e,t]=(0,i.useState)("desc"),[a,x]=(0,i.useState)("name"),[f,j]=(0,i.useState)(0),[y,k]=(0,i.useState)(!1),[_,T]=(0,i.useState)(10),[E,N]=(0,i.useState)(w()().subtract(1,"month").format("YYYY-MM-DD")),[O,z]=(0,i.useState)(w()().format("YYYY-MM-DD")),[A,B]=(0,i.useState)([]),[H,I]=(0,i.useState)([]);(0,i.useEffect)(()=>{getData()},[]);let getData=async()=>{let e=await n.Z.get(F.b.clientReportData+E+"/"+O);if(200==e.status){let t=await e.data;I(t=processData(t)),B(t)}},generateReport=()=>{getData()},handleDateChange=(e,t)=>{e=w()(e).format("YYYY-MM-DD"),"start"===t?N(e):z(e)},processData=e=>{let t=[];return e.map(e=>{let a=0,r=0;e.orders.map(e=>{a+=e.product_amount,r+=parseFloat(e.total)});let n=e.orders.length<5?"Espor\xe1dico":e.orders.length<10?"Ocasional":"Frecuente";t.push(getClientJSON(e.id,e.name,e.email,e.phone,e.orders.length,a,r,n))}),t},getClientJSON=(e,t,a,r,n,i,l,s)=>({id:e,name:t,email:a,phone:r,numBuys:n,totalProducts:i,total:l,category:s}),clientSearch=e=>{B(""===e?H:H.filter(t=>(t.name.toLowerCase()+" "+t.email.toLowerCase()).includes(e.toLowerCase())))},L=(0,i.useMemo)(()=>(function(e,t){let a=e.map((e,t)=>[e,t]);return a.sort((e,a)=>{let r=t(e[0],a[0]);return 0!==r?r:e[1]-a[1]}),a.map(e=>e[0])})(A,"desc"===e?(e,t)=>descendingComparator(e,t,a):(e,t)=>-descendingComparator(e,t,a)).slice(f*_,f*_+_),[A,e,a,f,_]),Q=f>0?Math.max(0,(1+f)*_-A.length):0;function descendingComparator(e,t,a){return t[a]<e[a]?1:t[a]>e[a]?-1:0}return(0,r.jsx)(l.Z,{style:{marginTop:"10vh"},children:(0,r.jsxs)(d.Z,{sx:{width:"100%"},children:[(0,r.jsxs)(P.Z,{sx:{width:"100%",mb:2},children:[(0,r.jsx)(b.Z,{sx:{flex:"1 1 100%",p:2},variant:"h5",id:"tableTitle",component:"div",children:"Informe de clientes"}),(0,r.jsx)(Z.Z,{children:(0,r.jsxs)(M.ZP,{container:!0,spacing:2,children:[(0,r.jsxs)(Y._,{dateAdapter:v.y,children:[(0,r.jsx)(M.ZP,{item:!0,xs:2,children:(0,r.jsx)(S.M,{format:"DD/MM/YYYY",defaultValue:w()(E),maxDate:w()(O),onChange:e=>handleDateChange(e,"start"),slotProps:{textField:{size:"small",helperText:"Fecha inicio"}}})}),(0,r.jsx)(M.ZP,{item:!0,xs:2,children:(0,r.jsx)(S.M,{format:"DD/MM/YYYY",defaultValue:w()(O),minDate:w()(E),onChange:e=>handleDateChange(e,"end"),slotProps:{textField:{size:"small",helperText:"Fecha fin"}}})})]}),(0,r.jsx)(M.ZP,{item:!0,xs:2,children:(0,r.jsx)(s.Z,{variant:"outlined",onClick:e=>generateReport(),children:"Generar"})}),(0,r.jsx)(M.ZP,{item:!0,xs:6,children:(0,r.jsx)(o.Z,{sx:{width:"100%"},id:"clientSearch",label:"Buscar cliente...",variant:"outlined",size:"small",onKeyUp:e=>clientSearch(e.target.value)})})]})}),(0,r.jsx)(g.Z,{children:(0,r.jsxs)(c.Z,{sx:{minWidth:750},"aria-labelledby":"tableTitle",size:y?"small":"medium",stickyHeader:!0,children:[(0,r.jsx)(clientes_enhancedTableHead,{order:e,orderBy:a,onRequestSort:(r,n)=>{let i=a===n&&"asc"===e;t(i?"desc":"asc"),x(n)}}),(0,r.jsxs)(u.Z,{children:[L.map((e,t)=>(0,r.jsxs)(m.Z,{hover:!0,tabIndex:-1,children:[(0,r.jsx)(h.Z,{align:"left",children:e.name}),(0,r.jsx)(h.Z,{align:"left",children:e.email}),(0,r.jsx)(h.Z,{align:"left",children:e.phone}),(0,r.jsx)(h.Z,{align:"right",children:e.numBuys}),(0,r.jsx)(h.Z,{align:"right",children:e.totalProducts}),(0,r.jsx)(h.Z,{align:"right",children:e.total}),(0,r.jsx)(h.Z,{align:"left",children:e.category})]},e.id)),Q>0&&(0,r.jsx)(m.Z,{style:{height:(y?33:53)*Q},children:(0,r.jsx)(h.Z,{colSpan:6})})]})]})}),(0,r.jsx)(p.Z,{rowsPerPageOptions:[5,10,25],component:"div",count:A.length,rowsPerPage:_,page:f,onPageChange:(e,t)=>{j(t)},onRowsPerPageChange:e=>{T(parseInt(e.target.value,10)),j(0)},labelRowsPerPage:"Clientes por pagina"})]}),(0,r.jsxs)(d.Z,{sx:{width:"100%"},children:[(0,r.jsx)(C.Z,{control:(0,r.jsx)(D.Z,{checked:y,onChange:e=>{k(e.target.checked)}}),label:"Espaciado de filas denso",style:{width:"88%"}}),(0,r.jsx)(s.Z,{variant:"outlined",onClick:()=>{let e=[{name:"Fecha inicio",value:E},{name:"Fecha fin",value:O}];(0,R.Z)({title:"Reporte de clientes",fileName:"reporte_clientes"},e,["Nombre","E-mail","Celular","Cant. Compras","# Productos","Total","Categoria"],A)},children:"Generar PDF"})]})]})})}},50898:function(e,t,a){"use strict";var r=a(60930);a(59567),t.Z=(e,t,a,n)=>{let i=new r.default,l=[];n.forEach(e=>{let t=Object.values(e);t=t.slice(1),l.push(t)});let s=15,o=15;i.text("UrbanMarket - "+e.title,o,s),s+=12,i.setFontSize(12),t.map(e=>{i.text(e.name+": "+e.value,o,s),o>145?(o=15,s+=10):o+=65}),s+=10,i.autoTable(a,l,{startY:s}),i.save(e.fileName+".pdf")}},90500:function(e,t,a){"use strict";var r=a(92173);let n=r.Z.create({baseURL:"http://urbanmarket.tis.cs.umss.edu.bo/api"});n.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&e.headers&&(e.headers.Authorization=t?"Bearer ".concat(t):""),e},e=>Promise.reject(e)),n.interceptors.response.use(e=>e,e=>Promise.reject(e)),t.Z=n},31601:function(e,t,a){"use strict";a.d(t,{b:function(){return r}});let r={hello:"/hello",user:"/user",profile:"/profile",logout:"/logout",profile:"/profile",reports:"/reportes",clientReportData:"/reporting/user/",userReportData:"/reporting/user-register/",userDelete:"/reporting/user/",inventaryReport:"/reportes/inventarios",inventaryReportData:"/reporting/inventary/",saleReportData:"/reporting/sale/",login:"/login",logout:"/logout",addFAQ:"/agregar-pregunta",editFAQ:"/editar-pregunta/",deleteFAQ:"/",FAQS:"/faqs",ordersYear:"reporting/ordersYears",economicReport:"reporting/economicReport"}}},function(e){e.O(0,[505,226,886,429,997,173,711,874,479,735,133,84,368,971,472,744],function(){return e(e.s=95730)}),_N_E=e.O()}]);